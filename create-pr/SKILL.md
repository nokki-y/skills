---
name: create-pr
description: PRを作成し、レビューガイド付きの説明を生成する。PR作成、プルリクエスト作成、PR説明生成時に使用。
disable-model-invocation: true
allowed-tools: Bash(git:*), Bash(gh:*), Read, Grep, Glob
---

# PR作成スキル

レビューガイド（変更ファイル一覧・推奨レビュー順序・レビュー観点）付きのPR説明を生成してPRを作成する。

## 実行手順

### 1. 現在のブランチ状態を確認

以下を並列で実行し、現在の状態を把握する：

- `git status`（未コミットの変更がないか確認）
- `git log --oneline <base-branch>..HEAD`（ベースブランチからの全コミット履歴）
- `git diff <base-branch>...HEAD --stat`（変更ファイルの統計）
- `git diff <base-branch>...HEAD`（変更の全体差分）
- リモートブランチの追跡状態を確認

**ベースブランチが不明な場合は `main` を使用する。**

未コミットの変更がある場合は、先にコミットするようユーザーに提案する。

### 2. 変更内容を深く分析

差分とコミット履歴から以下を分析する：

- **変更の目的**: 何のための変更か（新機能、バグ修正、リファクタリング等）
- **変更ファイルの分類**: 各ファイルのアーキテクチャ層・関心事を特定する
- **依存関係の把握**: ファイル間の依存関係、呼び出し関係、データの流れを理解する
- **各ファイルの差分を精読**: 追加・削除・変更された型、関数、ロジックを具体的に把握する

### 3. レビューガイドを設計

分析結果をもとに、レビューガイドのステップ構成を決定する：

1. **最適なレビュー順序を決定する**: 変更の性質に応じた順序を選ぶ（機械的にデフォルト順序を適用しない）
   - 型やスキーマの変更が多い → 下流から上流（型定義 → ロジック → API → UI）
   - エントリーポイントの変更が中心 → 上流から下流
   - 独立した変更が複数 → 重要度順
2. **ステップのグルーピング**: 同じアーキテクチャ層・同じ関心事のファイルを1つのStepにまとめる
3. **具体的なレビュー観点を作成**: 各ファイルの差分に基づき、チェックリスト形式で確認項目を書く
   - 抽象的な表現を避け、差分の内容に即した具体的な項目にする
   - 特に注意が必要なロジックはコードスニペットを含める

### 4. PR説明を生成

[templates/pr-description.md](templates/pr-description.md) のテンプレートと記載ルールに従い、PR説明を生成する。

### 5. PRを作成

以下の手順でPRを作成する：

1. 必要ならリモートにプッシュ（`git push -u origin <branch>`）
2. PRタイトルを作成（70文字以内、変更の目的を端的に表現）
3. `gh pr create` でPRを作成

```bash
gh pr create --title "<タイトル>" --body "$(cat <<'EOF'
<生成したPR説明>
EOF
)"
```

### 6. 結果を報告

作成したPRのURLをユーザーに表示する。

## 注意事項

- PRタイトルは70文字以内に収める
- 全コミット（最新だけでなくベースブランチからの全コミット）を分析対象にする
- レビューガイドはレビュアーの負荷を下げることが目的であることを意識する
- 未プッシュの場合は自動でプッシュする前にユーザーに確認する
